<body>
    <div class="container my-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="card-title text-center mb-4">Détails et Récapitulatif de la commande</h3>
  
          <!-- Contenu de la carte en deux colonnes -->
          <div class="row">
            <!-- Colonne: Formulaire -->
            <div class="col-lg-4">
                <h4><i class="bi bi-person-circle"></i> Vos détails</h4><hr>
              <form [formGroup]="adressForm">
                <div class="mb-3">
                  <label for="prenom" class="form-label">Prénom: <span class="color">*</span></label>
                  <input type="text" formControlName="prenom"  id="prenom" class="form-control" value="{{authService.userName}}" />
                  <div *ngIf="adressForm.get('prenom')?.invalid && adressForm.get('prenom')?.touched" class="text-danger">
                    Prénom required.
                  </div>
                </div>
                <div class="mb-3">
                  <label for="nom" class="form-label">Nom: <span class="color">*</span></label>
                  <input type="text" formControlName="nom" id="nom" class="form-control" value="{{authService.userName}}" />
                  <div *ngIf="adressForm.get('nom')?.invalid && adressForm.get('nom')?.touched" class="text-danger">
                    Nom required.
                  </div>
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email: <span class="color">*</span></label>
                  <input type="email"  id="email" class="form-control" value="{{authService.userEmail}}" disabled />
                </div>
                <div class="mb-3">
                  <label for="adresse" class="form-label">Adresse de livraison:<span class="color">*</span></label>
                  <input type="text" formControlName="adresse" id="adresse" class="form-control" placeholder="Votre adresse de livraison" />
                  <div *ngIf="adressForm.get('adresse')?.invalid && adressForm.get('adresse')?.touched" class="text-danger">
                    adresse is required.
                  </div>

                </div>
                <div class="mb-3">
                  <label for="telephone" class="form-label">Téléphone: <span class="color">*</span></label>
                  <input type="text" formControlName="telephone"  id="telephone" class="form-control" placeholder="Votre numéro de téléphone" />
                  <div *ngIf="adressForm.get('telephone')?.invalid && adressForm.get('telephone')?.touched" class="text-danger">
                    Téléphone doit être valide (8 chiffres).
                  </div>
                </div>
  
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="ville" class="form-label">City: <span class="color">*</span></label>
                    <input type="text" formControlName="City" id="ville" class="form-control" placeholder="Votre ville" />
                    <div *ngIf="adressForm.get('City')?.invalid && adressForm.get('City')?.touched" class="text-danger">
                      city is required
                    </div>       
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="code-postal" class="form-label">Zip / Code postal: <span class="color">*</span></label>
                    <input type="text" formControlName="codePostal" id="code-postal" class="form-control" placeholder="Code postal" />
                    <div *ngIf="adressForm.get('codePostal')?.invalid && adressForm.get('codePostal')?.touched" class="text-danger">
                      Code postal (4 chiffres).
                    </div>                
                  </div>
                </div>
                <div class="mb-3">
                  <label for="pays" class="form-label">Pays:</label>
                  <select id="pays" class="form-select">
                    <option value="tunisie" selected>Tunisie</option>
                    <option value="autre" disabled>Autre</option>
                  </select>
                </div>
              </form>
            </div>
  
            <!-- Colonne: Récapitulatif de la commande -->
            <div class="col-lg-8">
              <h4 > <i class="bi bi-cart-fill"></i> Récapitulatif de la commande</h4> <hr>
             
              <!-- Liste des produits dans le panier -->
              <ul class="list-group mb-3">
                <li
                  class="list-group-item d-flex justify-content-between align-items-center"
                  *ngFor="let item of panierService.items"
                >
                  <div class="d-flex align-items-center">
                    <!-- Image du produit -->
                    <img
                      [src]="item.product.images[0].startsWith('http') ? item.product.images[0] : 'assets/' + item.product.images[0]"
                      alt="Image du produit"
                      style="width: 100px; height: 90px; object-fit: cover; margin-right: 10px"
                    />
                    <!-- Nom et quantité -->
                    <div>
                      <span style="font-size: 15px;">{{ item.product.name }}</span>
                      <small class="text-muted d-block">Quantité: {{ item.quantity }}</small>
                    </div>
                  </div>
                  <!-- Prix du produit totalisé -->
                  <span class="price">
                    {{
                      item.quantity * (item.product.Price - item.product.promo || item.product.Price)
                    }},000 TND
                    <button (click)="removeFromCart(item.product._id!)" class="remove-button">
                        <i class="bi bi-trash-fill"></i>
                    </button>
                  </span>
                </li>
              </ul>
  
              <!-- Détails des totaux -->
              <div class="d-flex justify-content-between mb-2">
                <span>Sous-total:</span>
                <span>{{ getTotal() }},000 TND</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Livraison:</span>
                <span>{{ getTotal() >= 300 ? 'Gratuit' : '9,000 TND' }}</span>
              </div>
              <div class="d-flex justify-content-between fw-bold fs-5">
                <span>Total TTC:</span>
                <span>
                  {{ getTotal() + (getTotal() >= 300 ? 0 : 9) }},000 TND
                </span>
              </div>
  
              <!-- Bouton Commander -->
              <div class="d-flex">
                <button class="btn btn-success  ms-auto mt-3" (click)="addAdress()">Commander</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  